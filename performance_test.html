<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelivo PWA æ€§èƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .metric {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #1565C0;
        }
        .good { border-left-color: #4CAF50; }
        .warning { border-left-color: #FF9800; }
        .error { border-left-color: #F44336; }
        button {
            background: #1565C0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0D47A1;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1565C0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>ğŸš€ Kelivo PWA æ€§èƒ½æµ‹è¯•</h1>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºéªŒè¯ PWA æ€§èƒ½ä¼˜åŒ–æ•ˆæœã€‚</p>

    <h2>ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡</h2>
    <div id="metrics">
        <div class="metric">
            <strong>é¡µé¢åŠ è½½æ—¶é—´:</strong> <span id="loadTime">è®¡ç®—ä¸­...</span>
        </div>
        <div class="metric">
            <strong>Service Worker çŠ¶æ€:</strong> <span id="swStatus">æ£€æŸ¥ä¸­...</span>
        </div>
        <div class="metric">
            <strong>ç¼“å­˜çŠ¶æ€:</strong> <span id="cacheStatus">æ£€æŸ¥ä¸­...</span>
        </div>
        <div class="metric">
            <strong>ç½‘ç»œçŠ¶æ€:</strong> <span id="networkStatus">æ£€æŸ¥ä¸­...</span>
        </div>
    </div>

    <h2>ğŸ›  æµ‹è¯•å·¥å…·</h2>
    <button onclick="testServiceWorker()">æµ‹è¯• Service Worker</button>
    <button onclick="testCache()">æµ‹è¯•ç¼“å­˜</button>
    <button onclick="testPerformance()">æ€§èƒ½æµ‹è¯•</button>
    <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>

    <h2>ğŸ“ˆ æµ‹è¯•ç»“æœ</h2>
    <div id="results">
        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
    </div>

    <h2>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h2>
    <div id="suggestions">
        <p>æµ‹è¯•å®Œæˆåè¿™é‡Œä¼šæ˜¾ç¤ºä¼˜åŒ–å»ºè®®...</p>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶é—´è®¡ç®—
        window.addEventListener('load', function() {
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            document.getElementById('loadTime').textContent = loadTime + 'ms';
            
            // æ ¹æ®åŠ è½½æ—¶é—´æ·»åŠ æ ·å¼
            const metric = document.getElementById('loadTime').parentElement;
            if (loadTime < 1500) {
                metric.classList.add('good');
            } else if (loadTime < 3000) {
                metric.classList.add('warning');
            } else {
                metric.classList.add('error');
            }
        });

        // æ£€æŸ¥ Service Worker çŠ¶æ€
        function checkServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(registration => {
                    if (registration) {
                        document.getElementById('swStatus').textContent = 'å·²æ³¨å†Œ âœ…';
                        document.getElementById('swStatus').parentElement.classList.add('good');
                    } else {
                        document.getElementById('swStatus').textContent = 'æœªæ³¨å†Œ âŒ';
                        document.getElementById('swStatus').parentElement.classList.add('error');
                    }
                });
            } else {
                document.getElementById('swStatus').textContent = 'ä¸æ”¯æŒ âŒ';
                document.getElementById('swStatus').parentElement.classList.add('error');
            }
        }

        // æ£€æŸ¥ç¼“å­˜çŠ¶æ€
        function checkCache() {
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    if (cacheNames.length > 0) {
                        document.getElementById('cacheStatus').textContent = `${cacheNames.length} ä¸ªç¼“å­˜ âœ…`;
                        document.getElementById('cacheStatus').parentElement.classList.add('good');
                    } else {
                        document.getElementById('cacheStatus').textContent = 'æ— ç¼“å­˜ âš ï¸';
                        document.getElementById('cacheStatus').parentElement.classList.add('warning');
                    }
                });
            } else {
                document.getElementById('cacheStatus').textContent = 'ä¸æ”¯æŒ âŒ';
                document.getElementById('cacheStatus').parentElement.classList.add('error');
            }
        }

        // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
        function checkNetwork() {
            const status = navigator.onLine ? 'åœ¨çº¿ âœ…' : 'ç¦»çº¿ âš ï¸';
            document.getElementById('networkStatus').textContent = status;
            const metric = document.getElementById('networkStatus').parentElement;
            metric.classList.add(navigator.onLine ? 'good' : 'warning');
        }

        // æµ‹è¯• Service Worker
        function testServiceWorker() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading"></div> æµ‹è¯• Service Worker...';
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    let html = '<h3>Service Worker æµ‹è¯•ç»“æœ:</h3>';
                    if (registrations.length > 0) {
                        registrations.forEach((reg, index) => {
                            html += `<p>æ³¨å†Œ ${index + 1}: ${reg.scope}</p>`;
                            html += `<p>çŠ¶æ€: ${reg.active ? 'æ´»è·ƒ' : 'éæ´»è·ƒ'}</p>`;
                        });
                    } else {
                        html += '<p class="error">æœªæ‰¾åˆ° Service Worker æ³¨å†Œ</p>';
                    }
                    results.innerHTML = html;
                });
            } else {
                results.innerHTML = '<p class="error">æµè§ˆå™¨ä¸æ”¯æŒ Service Worker</p>';
            }
        }

        // æµ‹è¯•ç¼“å­˜
        function testCache() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading"></div> æµ‹è¯•ç¼“å­˜...';
            
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    let html = '<h3>ç¼“å­˜æµ‹è¯•ç»“æœ:</h3>';
                    if (cacheNames.length > 0) {
                        html += `<p>æ‰¾åˆ° ${cacheNames.length} ä¸ªç¼“å­˜:</p><ul>`;
                        cacheNames.forEach(name => {
                            html += `<li>${name}</li>`;
                        });
                        html += '</ul>';
                        
                        // æµ‹è¯•ç¼“å­˜å†…å®¹
                        Promise.all(cacheNames.map(name => 
                            caches.open(name).then(cache => cache.keys())
                        )).then(allKeys => {
                            const totalKeys = allKeys.reduce((sum, keys) => sum + keys.length, 0);
                            html += `<p>æ€»å…±ç¼“å­˜äº† ${totalKeys} ä¸ªèµ„æº</p>`;
                            results.innerHTML = html;
                        });
                    } else {
                        html += '<p class="warning">æœªæ‰¾åˆ°ç¼“å­˜æ•°æ®</p>';
                        results.innerHTML = html;
                    }
                });
            } else {
                results.innerHTML = '<p class="error">æµè§ˆå™¨ä¸æ”¯æŒç¼“å­˜ API</p>';
            }
        }

        // æ€§èƒ½æµ‹è¯•
        function testPerformance() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading"></div> è¿è¡Œæ€§èƒ½æµ‹è¯•...';
            
            const perf = performance.getEntriesByType('navigation')[0];
            let html = '<h3>æ€§èƒ½æµ‹è¯•ç»“æœ:</h3>';
            
            if (perf) {
                html += `<p>DNS æŸ¥è¯¢: ${Math.round(perf.domainLookupEnd - perf.domainLookupStart)}ms</p>`;
                html += `<p>TCP è¿æ¥: ${Math.round(perf.connectEnd - perf.connectStart)}ms</p>`;
                html += `<p>è¯·æ±‚å“åº”: ${Math.round(perf.responseEnd - perf.requestStart)}ms</p>`;
                html += `<p>DOM è§£æ: ${Math.round(perf.domContentLoadedEventEnd - perf.domLoading)}ms</p>`;
                html += `<p>æ€»åŠ è½½æ—¶é—´: ${Math.round(perf.loadEventEnd - perf.navigationStart)}ms</p>`;
                
                // è¯„åˆ†
                const totalTime = perf.loadEventEnd - perf.navigationStart;
                if (totalTime < 1500) {
                    html += '<p class="good">ğŸ‰ åŠ è½½é€Ÿåº¦ä¼˜ç§€!</p>';
                } else if (totalTime < 3000) {
                    html += '<p class="warning">âš ï¸ åŠ è½½é€Ÿåº¦ä¸€èˆ¬</p>';
                } else {
                    html += '<p class="error">âŒ åŠ è½½é€Ÿåº¦éœ€è¦ä¼˜åŒ–</p>';
                }
            } else {
                html += '<p>æ— æ³•è·å–è¯¦ç»†æ€§èƒ½æ•°æ®</p>';
            }
            
            results.innerHTML = html;
        }

        // æ¸…é™¤ç¼“å­˜
        function clearCache() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading"></div> æ¸…é™¤ç¼“å­˜...';
            
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    return Promise.all(cacheNames.map(name => caches.delete(name)));
                }).then(() => {
                    results.innerHTML = '<p class="good">âœ… ç¼“å­˜å·²æ¸…é™¤</p>';
                    checkCache(); // é‡æ–°æ£€æŸ¥ç¼“å­˜çŠ¶æ€
                });
            } else {
                results.innerHTML = '<p class="error">æ— æ³•æ¸…é™¤ç¼“å­˜</p>';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            checkServiceWorker();
            checkCache();
            checkNetwork();
        });

        // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('online', checkNetwork);
        window.addEventListener('offline', checkNetwork);
    </script>
</body>
</html>